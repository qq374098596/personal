{include file="public:head" /}
		<link rel="stylesheet" type="text/css" href="__STATIC__/Home/css/jmdp-detail.css"/>
	</head>
	<body>
		<!--顶部-->
		
		{include file="public:header" /}

	  <!--内容部分-->
	  <div id="content" v-cloak>
	  	<div class="describe">
	  		<!--头部-->
	  		<div class="title">
					<h5>{{thisone.name}}<span>一口豪大大大鸡排，变身当红炸子鸡！</span></h5>
					<div>当前位置：严选项目 - {{thisone.hyname}} - <span>{{thisone.name}}</span></div>
				</div>
				<!--图文部份-->
				<div class="img-text">
					<!--图片展示-->
					<div class="zhanshiimg">
						<div class="swiper-container bigimgbox">
							<div class="header-box"><img src="__STATIC__/Home/img/yxxm/yxxm1.png" /></div>
							<div class="swiper-wrapper">
					      <div class="swiper-slide" v-for="item in thisone.ppimglist"><img :src="item" /></div>
					    </div>
						</div>
						<div class="smallimgbox swiper-container">
							<div class="swiper-wrapper">
					      <div class="swiper-slide" v-for="item in thisone.ppimglist"><img :src="item" /></div>
					    </div>
						</div>
					</div>
					<!--文字展示-->
					<div class="zhanshitext">
						<div class="title">{{thisone.name}}<span>-{{thisone.hyname}}-</span></div>
						<div class="comment">
							<div class="star-box">
      					<div class="noactive"></div>
      					<div class="active" :style="{width:Math.floor(thisone.score/thisone.count)*22+'px'}"></div>
      				</div>
      				
      				<span>好评率：<a>{{Math.floor(thisone.score/thisone.count)?Math.floor(thisone.score/thisone.count)+'%':'暂无资料'}}</a></span>
						</div>
						<p class="joinmoney">
							<span>加盟费：<a>{{'￥'+thisone.jiamengfei}}W</a></span>
						</p>
						<!--<p><a>{{thisone.comnum}}</a>人点评</p>-->
						<p class="com-num">
							<span>用户评论：<a>{{thisone.normalcom}}</a></span>
							<span>加盟者评论：<a>{{thisone.joinercom}}</a></span>
						</p>
						<p class="shoucangnum"><img src="__STATIC__/Home/img/yxxm/like2.png" />{{thisone.likenum?thisone.likenum:0}}人收藏</p>
						<div class="btn-group">
							<p class="shoucang"><img src="__STATIC__/Home/img/jmdp-detail/like1.png" />收藏</p>
							<p class="fenxiang"><img src="__STATIC__/Home/img/jmdp-detail/share-icon.png" />分享</p>
							<p class="jubao"><img src="__STATIC__/Home/img/jmdp-detail/report-icon.png" />举报</p>
							<a href="javascript:;" target="_blank" class="dianping"><img src="__STATIC__/Home/img/yxxm/yxdp-icon.png" />写点评</a>
						</div>
					</div>
				</div>
	  	</div>
	  	
	  	<!--项目下部分-->
	  	<div class="bottom-content">
	  		<!--下边左侧-->
	  		<div class="out-title">最新点评</div>
	  		<div class="bottom-content-l">
	  			<!--最新点评-->
	  			<ul class="new-dianping">
	  				<li v-for="(item,index) in newReview"><a :href="item.jump">
	  					<img :src="item.imgsrc" :style="{backgroundColor: 'rgba('+Math.floor(Math.random() * 256)+','+Math.floor(Math.random() * 256)+','+Math.floor(Math.random() * 256)+', .2)'}" />
	  					<div>
	  						<h5>{{item.name}}</h5>
		  					<div class="star-box">
	      					<div class="noactive"></div>
	      					<div class="active" :style="{ width:Math.floor(item.soure/item.count)*22+'px' }"></div>
	      				</div>
	    					<div class="money-box">
	    						<p>加盟费: <span>{{parseInt(item.newreviewFee)}}W</span></p>
	    						<p>总成本: <span>{{parseInt(item.newreviewCost)}}W</span></p>
	    					</div>
	    					<p>加盟时间: {{item.newreviewTime}}</p>
	    					<p>月盈利: <span>{{parseInt(item.newreviewProfit)}}W</span></p>
	  					</div>
	  				</a></li>
	  			</ul>
	  			<!--盟友点评-->
	  			<div class="out-title">盟友点评(1234)</div>
	  			<div class="dianping-page">
	  				<div class="reviews-btn">
	  					<p @click="selectpingjia" data-val="">全部</p>
	  					<p @click="selectimg">图片（2156）</p>
	  					<p @click="selectpingjia" data-val="好评">好评（1985）</p>
	  					<p @click="selectpingjia" data-val="中评">中评（138）</p>
	  					<p @click="selectpingjia" data-val="差评">差评（138）</p>
	  				</div>
	  				<ul class="reviews-content reviews-content-pingjia">
	  					<li v-for="(item,index) in review" v-if="pingjia == '' ? true : item.pingjia==pingjia">
	  						<div class="header-box"><img :src="item.imgsrc" :style="{background:randomColor}" /></div>
	  						<div class="content-right">
	  							<h5>{{item.nickname}}<span>{{item.state}}</span></h5>
	  							<div class="star-box">
		      					<div class="noactive"></div>
		      					<div class="active" :style="{width:item.pingfen*22+'px'}"></div>
		      				</div>
		      				<!--严选信息-->
		      				<div class="join-infor">
		      					<p>加盟费：<span>{{'￥'+item.jiamengfei+'万'}}</span></p>
		      					<p>总成本：<span>￥{{item.zongchengben}}万</span></p>
		      					<p>加盟时间：<span>{{item.date}}</span></p>
		      					<p>月营收：<span>{{item.yueyingshou}}万</span></p>
		      					<p>开店城市：<span>{{item.city}}</span></p>
		      					<span><img src="__STATIC__/Home/img/yxxm/company-icon.png" />{{item.company}}</span>
		      				</div>
		      				<!--评论内容-->
		      				<div class="comment-content">
		      					<p>{{item.content}}</p>
		      				</div>
		      				
		      				<div class="comment-btn">
		      					<p>{{item.time}}</p>
		      					<p class="btn"><span>展开评论</span><a></a></p>
		      				</div>
		      				<!--图片部分-->
		      				<div class="comment-img" v-if="item.imglist">
		      					<div class="small-img" :data-index="index" ref="smallimg">
								      <img :src="img" onerror="this.src='__STATIC__/Home/img/loading.gif'" v-for="(img,index) in item.imglist" :style="{background:randomColor}" @click="showbigimg($event,index)" :class="{active:img.isactive}"  />
										</div>
										<div class="big-img" v-if="item.bigimg">
								      <img :src="item.bigimg" onerror="this.src='__STATIC__/Home/img/loading.gif'" :data-index="index" @click="hidebigimg($event)" />
								      <div @click="previmg($event)" class="prev-btn btn"><p>&lt;</p></div>
								      <div @click="nextimg($event)" class="next-btn btn"><p>&gt;</p></div>
										</div>
		      				</div>
		      				
		      				<div class="comment-replay">
		      					<span class="good-comment">赞（{{item.likenum?item.likenum:0}}）</span>
		      					<span class="write-btn" @click="writeClick(index,$event)">回应（{{item.replaynum?item.replaynum:0}}）</span>
		      					<div class="write-comment">
		      						<textarea></textarea>
		      						<p @click="fabiao(index,$event)">发表</p>
		      					</div>
		      				</div>
		      				<!--网友回应-->
		      				<div class="replay-box" v-if="item.reply!=''">
		      					<div class="title">网友回应</div>
		      					<ul>
		      						<li v-for="replay in item.reply">
		      							<div class="header">
		      								<img :src="replay.header" :style="{background:randomColor}" />
		      							</div>
		      							<div class="replay-right">
		      								<h5>{{replay.nickname}}</h5>
			      							<p>{{replay.content}}</p>
			      							<div class="replay-bottom">
			      								<p>{{replay.time}}</p>
			      								<span>回应</span>
			      							</div>
		      							</div>
		      						</li>
		      					</ul>
		      				</div>
	  						</div>
	  					</li>
	  				</ul>
	  				<div class="dianping-pagination"></div>
	  			</div>
	  		</div>
	  		<!--下边右侧-->
	  		<div class="bottom-content-r">
	  			<div class="title">推荐品牌</div>
	  			<ul>
	  				<li v-for="(item,index) in recReview"><a :href="'{:url('review/detail')}/id/'+item.id+''">
	  					<img :src="item.imgsrc" :style="{background:randomColor}" />
	  					<div>
	  						<h5>{{item.name}}</h5>
		  					<div class="star-box">
	      					<div class="noactive"></div>
	      					<div class="active" :style="{ width:Math.floor(item.soure/item.count)*22+'px' }"></div>
	      				</div>
	    					<p>好评率：<span>{{item.haopinglv?item.haopinglv:0}}%</span></p>
	    					<p>评论人数：<span>{{item.comnum?item.comnum:0}}人</span></p>
	    					<p>加盟者评论：<span>{{item.joincomnum?item.joincomnum:0}}人</span></p>
	  					</div>
	  				</a></li>
	  			</ul>
	  		</div>
			</div>
			
		</div>
		<!--底部-->
		
	{include file="public:footer" /}

<script src="__STATIC__/Home/js/jquery.pagination.js"></script>
<script src="__STATIC__/Home/js/swiper.js"></script>
<script src="__STATIC__/Home/js/vue.js"></script>
<script>
	var vm = new Vue({
		el: '#content',
		data: {
			pingjia: '',
			thisone: {
//				ppimglist: [
//					'__STATIC__/Home/img/yxxm/user1.png',
//					'__STATIC__/Home/img/yxxm/user1.png',
//				]
			},
			//最新点评
			newReview: [],
			//盟友点评
			review: [
				{
					pingjia: '中评',
					name: '西瓜你个萝卜头中',
					header: 'img/yxxm/user1.png',
					state: '开店中',
					star: 7,
					joinmoney: 1,
					allmoney: 7,
					jointime: '2018-11-07',
					mounthin: 10,
					city: '沈阳',
					company: '上海创杨信息技术有限公司',
					content: '跟抢没区别，之前承诺过得开店大力扶持，老师亲自上门合同之后交了钱哈哈你自己看着办吧 承诺你7万开店那是在做梦，反正签完合同你想让他们帮你干什么都是要钱跟抢没区别，之前承诺过得开店大力扶持，老师亲自上门!',
					time: '2018-11-09',
					imglist: [ 
						{ src: 'img/yxxm/elm-1.png', isactive: false },
						{ src: 'img/yxxm/elm-2.png', isactive: false },
						{ src: 'img/yxxm/elm-3.png', isactive: false },
						{ src: 'img/yxxm/elm-4.png', isactive: false },
						{ src: 'img/yxxm/elm-5.png', isactive: false },
					],
					bigimg: '',
					likenum: 18,
					replaynum: 2,
					children: [
						{
							header: 'img/cyq/user1.png',
							name: '你妈喊你回家吃饭',
							content: '反正签完合同你想让他们帮你干什么都是要钱跟抢没区别，之前承诺过得开店大力扶持，老师亲自上门......',
							time: '2018-11-09',
						},
						{
							header: 'img/cyq/user2.png',
							name: '回家吃饭哩',
							content: '反正签完合同你想让他们帮你干什么都是要钱跟抢没区别，之前承诺过得开店大力扶持，老师亲自上门......',
							time: '2018-11-09',
						}
					],
				},
				{
					pingjia:'好评',
					name: '西瓜你个萝卜头好',
					header: 'img/yxxm/user1.png',
					state: '开店中',
					star: 7,
					joinmoney: 1,
					allmoney: 7,
					jointime: '2018-11-07',
					mounthin: 10,
					city: '沈阳',
					company: '上海创杨信息技术有限公司',
					content: '跟抢没区别，之前承诺过得开店大力扶持，老师亲自上门合同之后交了钱哈哈你自己看着办吧 承诺你7万开店那是在做梦，反正签完合同你想让他们帮你干什么都是要钱跟抢没区别，之前承诺过得开店大力扶持，老师亲自上门!',
					time: '2018-11-09',
					imglist: [ 
						{ src: 'img/yxxm/elm-1.png', isactive: false },
						{ src: 'img/yxxm/elm-2.png', isactive: false },
						{ src: 'img/yxxm/elm-3.png', isactive: false },
						{ src: 'img/yxxm/elm-4.png', isactive: false },
						{ src: 'img/yxxm/elm-5.png', isactive: false },
					],
					bigimg: '',
					likenum: 18,
					replaynum: 2,
				},
				{
					pingjia: '差评',
					name: '西瓜你个萝卜头差',
					header: 'img/yxxm/user1.png',
					state: '开店中',
					star: 7,
					joinmoney: 1,
					allmoney: 7,
					jointime: '2018-11-07',
					mounthin: 10,
					city: '沈阳',
					company: '上海创杨信息技术有限公司',
					content: '跟抢没区别，之前承诺过得开店大力扶持，老师亲自上门合同之后交了钱哈哈你自己看着办吧 承诺你7万开店那是在做梦，反正签完合同你想让他们帮你干什么都是要钱跟抢没区别，之前承诺过得开店大力扶持，老师亲自上门!',
					time: '2018-11-09',
					likenum: 18,
					replaynum: 2,
				}
			],
			//推荐品牌
			recReview: [],
		},

		created:function(){
			var self = this;
			$.get("{:url('review/detailJson',['id'=>$id])}",function(data){
				var data = JSON.parse(data);
//				eval("("+data+")");
				console.log(data);
				self.thisone = data.detail;
				self.newReview = data.newReview;
				self.recReview = data.recReview;
				self.review = data.review;
				
			});
		},
		mounted: function(){
			var galleryThumbs = new Swiper('.smallimgbox', {
		    spaceBetween: 12,
		    slidesPerView: 5,
		    watchSlidesVisibility: true,
		    watchSlidesProgress: true,
		  });
		  var galleryTop = new Swiper('.bigimgbox', {
		    spaceBetween: 10,
		    thumbs: {
		      swiper: galleryThumbs,
		    },
		  });
		},

		computed: {
			randomColor: function(i){
				let bgcolor = 'rgba('+Math.floor(Math.random() * 256)+','+Math.floor(Math.random() * 256)+','+Math.floor(Math.random() * 256)+', .2)'
				return bgcolor;
			},
		},
		
		methods:{	
			
			//根据评价进行选择
			selectpingjia: function(e){
				var val = $(e.target).data('val');
				this.pingjia = val;
				$('.reviews-content-img').hide();
				$('.reviews-content-pingjia').show();
			},
			selectimg: function(){
				$('.reviews-content-pingjia').hide();
				$('.reviews-content-img').show();
			},
			
			//点击小图显示大图
			showbigimg: function(e,i){
			  var pinglunindex = $(e.target).parent().data('index');
			  var self = this;
			  if($(e.target).hasClass('active')){
			  	$(e.target).removeClass('active');
			  	self.review[pinglunindex].bigimg = '';
			  }else{
			  	$(e.target).siblings().removeClass('active');
				  $(e.target).addClass('active');
//				  self.review[pinglunindex].bigimg = self.review[pinglunindex].imglist[i];
				 	self.$set(self.review[pinglunindex],'bigimg',self.review[pinglunindex].imglist[i])
				 	console.log(typeof(self.review[pinglunindex]));
			  }
			},
			//切换放大图
			previmg: function(e){
				let index = $(e.currentTarget).parent().siblings('.small-img').children('.active').index();
				let length = $(e.currentTarget).parent().siblings('.small-img').children('img').length;
				if(length==1){
					return false;
				}else{
					index--;
					if(index == -1 ){
						index = length -1;
					}
					$(e.currentTarget).parent().siblings('.small-img').children('img').eq(index).click();
				}
			},
			nextimg: function(e){
				let index = $(e.currentTarget).parent().siblings('.small-img').children('.active').index();
				let length = $(e.currentTarget).parent().siblings('.small-img').children('img').length;
				if(length==1){
					return false;
				}else{
					index++;
					console.log(index,length)
					if(index == length ){
						index = 0;
					}
					$(e.currentTarget).parent().siblings('.small-img').children('img').eq(index).click();
				}
			},
			//点击大图隐藏
			hidebigimg: function(e){
				var pinglunindex = $(e.target).data('index');
				$(this.$refs.smallimg).children('img').removeClass('active');
				this.review[pinglunindex].bigimg = '';
			},
			fabiao: function(i,e){
				var content = $(e.target).siblings('textarea').val();
				this.review[i].reply.push({
					header: '__STATIC__/Home/img/cyq/user1.png',
					name: '你妈喊你回家吃饭',
					content: content,
					time: '2018-11-09',
				});
				$(e.target).siblings('textarea').val('');
				$(e.target).parent().fadeOut(100);
			},
			writeClick: function(i,e){
				$(e.target).siblings('.write-comment').fadeToggle(100);
			},
		}
	});
	
	
	//项目评论中的功能
	$(function(){
		//评论是否需要展开
		$('.comment-content').each(function(i){
			if($(this).height()>=80){
				$(this).height(80);
				$(this).siblings('.comment-btn').children('.btn').show();
			}else{
				$(this).height('auto');
				$(this).siblings('.comment-btn').children('.btn').hide();
			}
		});
		
		//展开收起评论文本内容
		$('.comment-btn .btn').click(function(){
			if($(this).hasClass('develop')){
				$(this).children('span').html('展开评论');
				$(this).parent().siblings('.comment-content').height(80);
				$(this).removeClass('develop');
			}else{
				$(this).children('span').html('收起评论');
				$(this).parent().siblings('.comment-content').height('auto');
				$(this).addClass('develop');
			}
		});
		
	});   //评论功能 end
	

	
	//切换好评差评
	$('.reviews-btn p').click(function(){
		$(this).siblings().removeClass('active');
		$(this).addClass('active');
	});
	
	//分页插件
	$('.dianping-pagination').pagination({
		totalData: 320,				//总数据条数
		showDate: 10,
		pageCount : 32, 			//总页数
		current: 1,						//当前页
		prevContent:'&lang;',
		nextContent:'&rang;',
		keepShowPN:true,			
		mode:'fixed',
		count: 8,
		coping:true,
		homePage:'首',
		endPage:'末',
		isHide:true,
		jump:false,
		callback:function(apis){
			//跳转要做的事件
			
		}
	});	
	
	
	
	//头部导航选择
	// $('.nav ul li').click(function(){
	// 	$(this).siblings().removeClass('active');
	// 	$(this).addClass('active');
	// });
	$('.nav ul li').siblings().removeClass('active');
	$('.jmdp').addClass('active');
	
	//详情图轮播
	
	
</script>
